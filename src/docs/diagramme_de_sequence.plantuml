@startuml
title Diagramme de séquence — Récupération des actualités

actor Client
boundary "PreferencesApi" as API
control "NewsService" as Service
control "NewsCollectionFactory" as Factory
control "LLMScorer" as Scorer
control "NewsSorter" as Sorter
entity "RssFetcher(s)" as Fetchers

== Appel ==
Client -> API : GET /news?themes=...
activate API

API -> Service : getNewsForThemes(themes)
activate Service

Service -> Factory : fromSources(fetchers, themes)
activate Factory

loop pour chaque source RSS
  Factory -> Fetchers : fetch()
  Fetchers --> Factory : List<News>
end

Factory --> Service : NewsCollection
deactivate Factory

Service -> Scorer : score(collection.items, themes)
activate Scorer
Scorer --> Service : List<NewsCategoryScore>
deactivate Scorer

Service -> Sorter : sort(collection)
activate Sorter
Sorter --> Service : NewsCollection (triée)
deactivate Sorter

Service --> API : NewsCollection
deactivate Service

API --> Client : 200 OK\nList<NewsDTO>
deactivate API

== Erreur (alt) ==
alt source RSS indisponible
  Fetchers --> Factory : ApiException
  Factory --> Service : collection partielle
else échec critique
  Service --> API : ApiException
  API --> Client : 5xx ErrorResponse
end

@enduml
